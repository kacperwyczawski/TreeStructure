@using TreeStructure.Services
@using TreeStructure.Models
@inject NodeService NodeService

<li style="list-style-type: none">
    <!-- TODO: Fix this warnings -->
    <TreeItem Text="@RootNode.Name"
              Id="@((int)RootNode.Id)"
              OnCollapse="@(() => IsCollapsed = true)"
              OnExpand="@(() => IsCollapsed = false)"
              OnDelete="@(() => NodeService.DeleteNode((int)RootNode.Id))"
              OnEdit="@HandleEdit"
              IsCollapsed="IsCollapsed"/>
    @if (NodeService.GetChildren((int)RootNode.Id) is var children && children.Any() && !IsCollapsed)
    {
        <ul>
            @foreach (var child in children)
            {
                <Tree RootNode="@child" OnEdit="@OnEdit"/>
            }
        </ul>
    }
</li>

@code {

    [Parameter]
    public Node RootNode { get; set; }

    [Parameter]
    public bool IsCollapsed { get; set; } = true;

    [Parameter]
    public EventCallback<Node> OnEdit { get; set; }

    void HandleEdit()
    {
        OnEdit.InvokeAsync(RootNode);
    }

    bool _showEditDialog = false;

}